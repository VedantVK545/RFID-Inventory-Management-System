<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css?v=1.3">
    <link rel="stylesheet" href="/css/blob-theme.css?v=1.1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Round">
    
    <!-- Critical inline styles to force proper display -->
    <style>
      html, body {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        height: 100% !important;
        overflow-x: hidden !important;
        background: #0f172a !important;
      }
      
      /* Fallback animation keyframes */
      @keyframes float {
        0%, 100% { transform: translate(0, 0) scale(1); }
        25% { transform: translate(50px, -50px) scale(1.1); }
        50% { transform: translate(-20px, 40px) scale(0.9); }
        75% { transform: translate(-40px, -30px) scale(1.05); }
      }
      
      /* Mica Effect */
      .auth-card, .card, .stat-card, .action-card, .sidebar, .modal-content {
        background: rgba(23, 28, 38, 0.7) !important;
        backdrop-filter: blur(16px) saturate(180%) !important;
        -webkit-backdrop-filter: blur(16px) saturate(180%) !important;
        border: 1px solid rgba(255, 255, 255, 0.08) !important;
      }
    </style>
</head>
<body>
    <!-- Direct blob HTML as fallback -->
    <div class="blob-container" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; overflow:hidden; pointer-events:none;">
        <div class="blob" style="position:absolute; width:600px; height:600px; filter:blur(100px); opacity:0.5; animation:float 10s ease-in-out infinite; background:radial-gradient(circle at center, #4f46e5 0%, transparent 70%); top:-200px; left:-200px; animation-delay:-2s; pointer-events:none;"></div>
        <div class="blob" style="position:absolute; width:600px; height:600px; filter:blur(100px); opacity:0.5; animation:float 10s ease-in-out infinite; background:radial-gradient(circle at center, #0ea5e9 0%, transparent 70%); bottom:-200px; right:-200px; animation-delay:-3s; pointer-events:none;"></div>
        <div class="blob" style="position:absolute; width:600px; height:600px; filter:blur(100px); opacity:0.5; animation:float 10s ease-in-out infinite; background:radial-gradient(circle at center, #2563eb 0%, transparent 70%); bottom:300px; left:50%; animation-delay:-4s; pointer-events:none;"></div>
    </div>
    
    <div class="dashboard">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>RFID Inventory</h3>
                <p id="username">Loading...</p>
            </div>
            
            <div class="sidebar-menu">
                <a href="/" class="menu-item active">
                    <span class="material-icons-round">dashboard</span> Dashboard
                </a>
                
                <a href="/inventory" class="menu-item">
                    <span class="material-icons-round">inventory_2</span> Inventory
                </a>
                
                <a href="/rfid" class="menu-item">
                    <span class="material-icons-round">rss_feed</span> RFID Devices
                </a>
                
                <a href="/receiptlogs" class="menu-item">
                    <span class="material-icons-round">receipt_long</span> Transactions
                </a>
                
                <a href="/usercores" class="menu-item">
                    <span class="material-icons-round">group</span> Users
                </a>
                
                <a href="/userlogs" class="menu-item">
                    <span class="material-icons-round">visibility</span> Activity Logs
                </a>
                
                <a href="logout" class="menu-item">
                    <span class="material-icons-round">logout</span> Logout
                </a>
            </div>
        </div>
    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">Dashboard</h1>
            <div class="breadcrumb">
                <div class="breadcrumb-item">Home</div>
                <div class="breadcrumb-item">Dashboard</div>
            </div>
        </div>
    
        <div class="stats-grid">
            <div class="stat-card">
                <span class="material-icons-round" style="font-size: 3rem; color: var(--primary-color);">inventory_2</span>
                <h3>Inventory Items</h3>
                <div class="stat-value" id="itemCount">0</div>
            </div>
            
            <div class="stat-card">
                <span class="material-icons-round" style="font-size: 3rem; color: var(--info-color);">rss_feed</span>
                <h3>RFID Devices</h3>
                <div class="stat-value" id="deviceCount">0</div>
            </div>
            
            <div class="stat-card">
                <span class="material-icons-round" style="font-size: 3rem; color: var(--success-color);">group</span>
                <h3>Users</h3>
                <div class="stat-value" id="userCount">0</div>
            </div>
            
            <div class="stat-card">
                <span class="material-icons-round" style="font-size: 3rem; color: var(--warning-color);">receipt_long</span>
                <h3>Transactions</h3>
                <div class="stat-value" id="transactionCount">0</div>
            </div>
        </div>
    
        <h2 style="margin-bottom: 1.75rem; color: var(--text-primary); font-weight: 600;">Quick Actions</h2>
        
        <div class="action-grid">
            <a href="/inventory" class="action-card">
                <span class="material-icons-round action-icon">inventory_2</span>
                <div class="action-title">View Inventory</div>
                <div class="action-description">Browse and manage inventory items</div>
            </a>
            
            <a href="/rfid" class="action-card">
                <span class="material-icons-round action-icon">rss_feed</span>
                <div class="action-title">Manage Devices</div>
                <div class="action-description">Configure RFID devices and scanners</div>
            </a>
            
            <a href="/receiptlogs" class="action-card">
                <span class="material-icons-round action-icon">receipt_long</span>
                <div class="action-title">Transaction Logs</div>
                <div class="action-description">View transaction history and reports</div>
            </a>
            
            <a href="/usercores" class="action-card" id="userActionCard">
                <span class="material-icons-round action-icon">admin_panel_settings</span>
                <div class="action-title">Manage Users</div>
                <div class="action-description">Configure system users and permissions</div>
            </a>
            
            <!-- <a href="/settings" class="action-card">
                <span class="material-icons-round action-icon">settings</span>
                <div class="action-title">Settings</div>
                <div class="action-description">Configure system preferences</div>
            </a>
             -->
            <a href="/userlogs" class="action-card">
                <span class="material-icons-round action-icon">visibility</span>
                <div class="action-title">Activity Logs</div>
                <div class="action-description">View system and user activities</div>
            </a>
        </div>
    </div>
    <script src="/js/userinfo.js"></script>
    <script src="/js/blob-animation.js"></script>
    <script>
        async function fetchCounts() {
            try {
                // Fetch inventory count
                const inventoryResponse = await fetch('/getallitems');
                const inventoryItems = await inventoryResponse.json();
                document.getElementById('itemCount').textContent = inventoryItems.length;

                // Fetch transaction logs count
                try {
                    const transactionResponse = await fetch('/inventorylogs');
                    const transactionLogs = await transactionResponse.json();
                    document.getElementById('transactionCount').textContent = transactionLogs.length;
                } catch (err) {
                    console.error('Error fetching transactions:', err);
                    document.getElementById('transactionCount').textContent = '0';
                }

                // Fetch RFID devices count
                try {
                    const rfidResponse = await fetch('/getalldevices');
                    const rfidDevices = await rfidResponse.json();
                    document.getElementById('deviceCount').textContent = rfidDevices.length;
                } catch (err) {
                    console.error('Error fetching devices:', err);
                    document.getElementById('deviceCount').textContent = '0';
                }

                // Update the users count code to handle different response formats
                try {
                    const userResponse = await fetch('/getallusrs');
                    const userData = await userResponse.json();
                    
                    if (Array.isArray(userData)) {
                        // Admin response (array of users)
                        document.getElementById('userCount').textContent = userData.length;
                    } else if (userData.count !== undefined) {
                        // Regular user response (count object)
                        document.getElementById('userCount').textContent = userData.count;
                    } else {
                        document.getElementById('userCount').textContent = '0';
                    }
                } catch (err) {
                    console.error('Error fetching users:', err);
                    document.getElementById('userCount').textContent = '0';
                }
            } catch (error) {
                console.error('Error fetching counts:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchCounts);
    </script>
</body>
</html>
